# ABOUTME: nginx config for fly-replay routing
# ABOUTME: Routes ACME challenges to magnet-certbot, everything else to Convos

server {
    listen 8080 default_server;
    server_name _;

    # ACME challenges routed to certbot machine
    location /.well-known/acme-challenge/ {
        add_header fly-replay "app=magnet-certbot" always;
        return 200;
    }

    # Everything else gets fly-replay header to route to Convos
    location / {
        add_header fly-replay "app=magnet-convos" always;
        return 200;
    }
}
