/* ABOUTME: Leaf server configuration for magnet-irc anycast nodes
/* ABOUTME: Server identity derived dynamically from FLY_REGION at startup

/* Server information */
/* IMPORTANT: SERVER_NAME and SERVER_SID are set dynamically in start.sh from FLY_REGION */
serverinfo {
    name = "${SERVER_NAME}.${IRC_DOMAIN}";
    sid = "${SERVER_SID}";
    description = "${SERVER_DESCRIPTION}";
    network_name = "MagNET";
    ssl_cert = "/opt/solanum/etc/ssl.pem";
    ssl_private_key = "/opt/solanum/etc/ssl.key";
    ssl_dh_params = "/opt/solanum/etc/dh.pem";
};

/* Connection classes needed before connect blocks */
class "server" {
    ping_time = 5 minutes;
    connectfreq = 5 minutes;
    max_autoconn = 2;
    max_number = 10;
    sendq = 2 megabytes;
};

/* Connect to hub - leaves only connect to the hub, not to each other */
/* IMPORTANT: Connect block name must match the hub's serverinfo name exactly */
connect "magnet-9rl.${IRC_DOMAIN}" {
    host = "magnet-9rl.${IRC_DOMAIN}";
    send_password = "${HUB_PASSWORD}";
    accept_password = "${LEAF_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst, autoconn;
};
