/* ABOUTME: Hub server configuration for magnet-9rl
/* ABOUTME: Contains server-specific settings and includes common configuration

/* Server information */
/* IMPORTANT: The name field must match exactly with connect block names on other servers */
serverinfo {
    name = "${SERVER_NAME}.${IRC_DOMAIN}";
    sid = "${SERVER_SID}";
    description = "${SERVER_DESCRIPTION}";
    network_name = "MagNET";
    ssl_cert = "/opt/solanum/etc/ssl.pem";
    ssl_private_key = "/opt/solanum/etc/ssl.key";
    ssl_dh_params = "/opt/solanum/etc/dh.pem";
};

/* Connection classes needed before connect blocks */
class "server" {
    ping_time = 5 minutes;
    connectfreq = 5 minutes;
    max_autoconn = 2;
    max_number = 10;
    sendq = 2 megabytes;
};

/* Connection blocks - using Fly.io .internal DNS */
/* IMPORTANT: Connect block name must match the other server's serverinfo name exactly */
/* IMPORTANT: host field uses wildcard to match Fly.io VM reverse DNS */

/* Connect block for services */
connect "magnet-atheme.${IRC_DOMAIN}" {
    host = "*.vm.magnet-atheme.internal";
    send_password = "${SERVICES_PASSWORD}";
    accept_password = "${PASSWORD_9RL}";
    port = 7000;
    class = "server";
    flags = topicburst;
};

/* Connect blocks for magnet-irc anycast leaf servers */
/* These leaves connect TO hub with autoconn, hub accepts their connections */
/* Leaves use dynamic identity from FLY_REGION: magnet-ord, magnet-ams, etc. */
/* IMPORTANT: host field uses wildcard to match Fly.io VM reverse DNS (*.vm.magnet-irc.internal) */

/* Chicago (ord) - initial deployment */
connect "magnet-ord.${IRC_DOMAIN}" {
    host = "*.vm.magnet-irc.internal";
    send_password = "${LEAF_PASSWORD}";
    accept_password = "${HUB_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst;
};

/* Amsterdam (ams) - initial deployment */
connect "magnet-ams.${IRC_DOMAIN}" {
    host = "*.vm.magnet-irc.internal";
    send_password = "${LEAF_PASSWORD}";
    accept_password = "${HUB_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst;
};

/* Pre-configured future regions (harmless if no leaf exists) */

/* Singapore (sin) */
connect "magnet-sin.${IRC_DOMAIN}" {
    host = "*.vm.magnet-irc.internal";
    send_password = "${LEAF_PASSWORD}";
    accept_password = "${HUB_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst;
};

/* Sydney (syd) */
connect "magnet-syd.${IRC_DOMAIN}" {
    host = "*.vm.magnet-irc.internal";
    send_password = "${LEAF_PASSWORD}";
    accept_password = "${HUB_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst;
};

/* SÃ£o Paulo (gru) */
connect "magnet-gru.${IRC_DOMAIN}" {
    host = "*.vm.magnet-irc.internal";
    send_password = "${LEAF_PASSWORD}";
    accept_password = "${HUB_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst;
};

/* Seattle (sea) */
connect "magnet-sea.${IRC_DOMAIN}" {
    host = "*.vm.magnet-irc.internal";
    send_password = "${LEAF_PASSWORD}";
    accept_password = "${HUB_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst;
};

/* London (lhr) */
connect "magnet-lhr.${IRC_DOMAIN}" {
    host = "*.vm.magnet-irc.internal";
    send_password = "${LEAF_PASSWORD}";
    accept_password = "${HUB_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst;
};

/* Virginia (iad) */
connect "magnet-iad.${IRC_DOMAIN}" {
    host = "*.vm.magnet-irc.internal";
    send_password = "${LEAF_PASSWORD}";
    accept_password = "${HUB_PASSWORD}";
    port = 7000;
    class = "server";
    flags = topicburst;
};
