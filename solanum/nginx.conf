# ABOUTME: nginx config for ACME challenges and fly-replay to Convos
# ABOUTME: Serves Let's Encrypt challenges, redirects all other HTTP to Convos

server {
    listen 8080 default_server;
    server_name _;

    # Serve ACME challenge files for Let's Encrypt
    location /.well-known/acme-challenge/ {
        root /var/www;
        try_files $uri =404;
    }

    # Everything else gets fly-replay header to route to Convos
    location / {
        add_header fly-replay "app=magnet-convos" always;
        return 200;
    }
}
